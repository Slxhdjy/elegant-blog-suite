# ğŸ“„ é£ä¹¦æ–‡æ¡£å¯¼å…¥åŠŸèƒ½ - å®Œæ•´æŠ€æœ¯æ–‡æ¡£

<div align="center">

![Version](https://img.shields.io/badge/version-2.0-blue)
![Status](https://img.shields.io/badge/status-stable-green)
![Feature](https://img.shields.io/badge/feature-auto--upload-orange)

**ä¸€é”®å¯¼å…¥é£ä¹¦æ–‡æ¡£ï¼Œè‡ªåŠ¨å¤„ç†å›¾ç‰‡ï¼Œå®Œç¾è½¬æ¢ä¸º Markdown**

</div>

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [å®ç°æ€è·¯](#å®ç°æ€è·¯)
5. [è¯¦ç»†ä»£ç ](#è¯¦ç»†ä»£ç )
6. [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
7. [æ•ˆæœå±•ç¤º](#æ•ˆæœå±•ç¤º)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

é£ä¹¦æ–‡æ¡£å¯¼å…¥åŠŸèƒ½å…è®¸ç”¨æˆ·ç›´æ¥ä»é£ä¹¦æ–‡æ¡£å¤åˆ¶å†…å®¹ï¼Œç²˜è´´åˆ°åšå®¢ç³»ç»Ÿä¸­ï¼Œè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š

- âœ… **å¯Œæ–‡æœ¬è½¬ Markdown**ï¼šè‡ªåŠ¨è¯†åˆ«æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€ä»£ç å—ã€è¡¨æ ¼ç­‰æ ¼å¼
- âœ… **æ™ºèƒ½æ ‡é¢˜è¯†åˆ«**ï¼šæ ¹æ®å­—ä½“å¤§å°å’Œæ ·å¼è‡ªåŠ¨è¯†åˆ«æ ‡é¢˜å±‚çº§
- âœ… **å›¾ç‰‡è‡ªåŠ¨å¤„ç†**ï¼šä¸‰ç§æ¨¡å¼ï¼ˆè‡ªåŠ¨ä¸Šä¼ /Base64/ä¿ç•™URLï¼‰
- âœ… **é£ä¹¦å›¾ç‰‡ä¸‹è½½**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä¸‹è½½é£ä¹¦å›¾ç‰‡
- âœ… **æ‰¹é‡ä¸Šä¼ æœåŠ¡å™¨**ï¼šè‡ªåŠ¨ä¸Šä¼ åˆ°æœ¬åœ°æœåŠ¡å™¨ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- âœ… **è¿›åº¦å®æ—¶æ˜¾ç¤º**ï¼šæ˜¾ç¤ºå›¾ç‰‡å¤„ç†è¿›åº¦å’ŒçŠ¶æ€
- âœ… **é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šå¤±è´¥è‡ªåŠ¨é™çº§ï¼Œç¡®ä¿å†…å®¹ä¸ä¸¢å¤±

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. ä¸‰ç§å›¾ç‰‡å¤„ç†æ¨¡å¼

| æ¨¡å¼ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|------|------|---------|
| ğŸš€ **è‡ªåŠ¨ä¸Šä¼ ** | è‡ªåŠ¨ä¸‹è½½å¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ | æ°¸ä¹…å¯è®¿é—®ï¼Œä¸å localStorage | éœ€è¦å¯åŠ¨æœåŠ¡å™¨ | **æ¨è**ï¼Œå›¾ç‰‡è¾ƒå¤š |
| ğŸ“¦ **Base64** | è½¬æ¢ä¸ºBase64åµŒå…¥ | æ— éœ€æœåŠ¡å™¨ | å ç”¨å­˜å‚¨ç©ºé—´ | å›¾ç‰‡è¾ƒå°‘ï¼ˆ<5å¼ ï¼‰ |
| ğŸ”— **ä¿ç•™URL** | ä¿ç•™é£ä¹¦åŸå§‹é“¾æ¥ | ä¸å¤„ç† | å¯èƒ½æ— æ³•è®¿é—® | ä¸´æ—¶æµ‹è¯• |

### 2. æ™ºèƒ½æ ‡é¢˜è¯†åˆ«

```javascript
// æ ¹æ®å­—ä½“å¤§å°å’Œæ ·å¼è‡ªåŠ¨è¯†åˆ«æ ‡é¢˜å±‚çº§
fontSize >= 26px â†’ # ä¸€çº§æ ‡é¢˜
fontSize >= 20px â†’ ## äºŒçº§æ ‡é¢˜  
fontSize >= 16px + bold â†’ ### ä¸‰çº§æ ‡é¢˜
```

### 3. è‡ªåŠ¨æ¸…ç†åºå·

è‡ªåŠ¨å»é™¤é£ä¹¦æ–‡æ¡£ä¸­çš„åºå·æ ‡è®°ï¼š
- `1. æ ‡é¢˜` â†’ `# æ ‡é¢˜`
- `1.1 å­æ ‡é¢˜` â†’ `## å­æ ‡é¢˜`
- `ä¸€ã€ç« èŠ‚` â†’ `# ç« èŠ‚`

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é£ä¹¦æ–‡æ¡£å¯¼å…¥ç³»ç»Ÿ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ å‰ç«¯UI  â”‚        â”‚ è½¬æ¢å™¨  â”‚        â”‚ ä¸Šä¼ å™¨  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â”‚  1. ç²˜è´´å†…å®¹      â”‚                   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
        â”‚                   â”‚  2. è§£æHTML      â”‚
        â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                   â”‚  3. æå–å›¾ç‰‡      â”‚
        â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                   â”‚  4. ä¸‹è½½å›¾ç‰‡      â”‚
        â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                   â”‚  5. ä¸Šä¼ æœåŠ¡å™¨    â”‚
        â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  6. è¿”å›Markdown  â”‚                   â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
        â”‚  7. è·³è½¬ç¼–è¾‘å™¨    â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—

1. **FeishuImporter** - ä¸»å¯¼å…¥å™¨
   - æ˜¾ç¤ºå¯¼å…¥å¯¹è¯æ¡†
   - å¤„ç†ç”¨æˆ·è¾“å…¥
   - åè°ƒè½¬æ¢æµç¨‹

2. **FeishuImageDownloader** - å›¾ç‰‡å¤„ç†å™¨
   - æ£€æµ‹é£ä¹¦å›¾ç‰‡
   - ä¸‹è½½å›¾ç‰‡
   - ä¸Šä¼ åˆ°æœåŠ¡å™¨

3. **Unified Server** - ç»Ÿä¸€æœåŠ¡å™¨
   - æ¥æ”¶å›¾ç‰‡ä¸Šä¼ 
   - å­˜å‚¨åˆ°æœ¬åœ°
   - è¿”å›è®¿é—®URL

---


## ğŸ’¡ å®ç°æ€è·¯

### æ•´ä½“æµç¨‹

```
ç”¨æˆ·æ“ä½œ
   â†“
å¤åˆ¶é£ä¹¦æ–‡æ¡£ (Ctrl+C)
   â†“
ç²˜è´´åˆ°å¯¼å…¥æ¡† (Ctrl+V)
   â†“
ä¿ç•™å¯Œæ–‡æœ¬æ ¼å¼ (HTML)
   â†“
DOM è§£æ â†’ Markdown
   â†“
æ£€æµ‹é£ä¹¦å›¾ç‰‡ URL
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©å›¾ç‰‡å¤„ç†æ¨¡å¼        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è‡ªåŠ¨ä¸Šä¼ ï¼ˆæ¨èï¼‰      â”‚
â”‚    â”œâ”€ ä¸‹è½½é£ä¹¦å›¾ç‰‡       â”‚
â”‚    â”œâ”€ ä¸Šä¼ åˆ°æœåŠ¡å™¨       â”‚
â”‚    â””â”€ æ›¿æ¢ä¸ºæœ¬åœ°URL      â”‚
â”‚                          â”‚
â”‚ 2. Base64 è½¬æ¢           â”‚
â”‚    â”œâ”€ ä¸‹è½½é£ä¹¦å›¾ç‰‡       â”‚
â”‚    â””â”€ è½¬æ¢ä¸ºBase64       â”‚
â”‚                          â”‚
â”‚ 3. ä¿ç•™ URL              â”‚
â”‚    â””â”€ ä¸å¤„ç†å›¾ç‰‡         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
ç”Ÿæˆæœ€ç»ˆ Markdown
   â†“
ä¿å­˜åˆ° localStorage
   â†“
è·³è½¬åˆ°ç¼–è¾‘å™¨
```

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. å¯Œæ–‡æœ¬ç²˜è´´ä¿ç•™

```javascript
// ç›‘å¬ç²˜è´´äº‹ä»¶ï¼Œä¿ç•™HTMLæ ¼å¼
pasteArea.addEventListener('paste', (e) => {
    const clipboardData = e.clipboardData || window.clipboardData;
    const htmlData = clipboardData.getData('text/html');
    
    if (htmlData) {
        e.preventDefault(); // é˜»æ­¢é»˜è®¤ç²˜è´´
        
        // è§£æå¹¶æ’å…¥HTML
        const temp = document.createElement('div');
        temp.innerHTML = htmlData;
        pasteArea.appendChild(temp);
    }
});
```

#### 2. DOM é€’å½’è§£æ

```javascript
// é€’å½’å¤„ç†æ¯ä¸ªèŠ‚ç‚¹
const processNode = async (node) => {
    if (node.nodeType === Node.TEXT_NODE) {
        return node.textContent;
    }
    
    if (node.nodeType !== Node.ELEMENT_NODE) {
        return '';
    }
    
    const tagName = node.tagName.toLowerCase();
    
    switch (tagName) {
        case 'h1': return '# ' + node.textContent + '\n\n';
        case 'h2': return '## ' + node.textContent + '\n\n';
        case 'p': 
            // æ™ºèƒ½è¯†åˆ«æ ‡é¢˜
            const style = window.getComputedStyle(node);
            const fontSize = parseFloat(style.fontSize);
            if (fontSize >= 26) {
                return '# ' + node.textContent + '\n\n';
            }
            return node.textContent + '\n\n';
        // ... å…¶ä»–æ ‡ç­¾å¤„ç†
    }
};
```

#### 3. é£ä¹¦å›¾ç‰‡æ£€æµ‹

```javascript
// æ£€æµ‹URLæ˜¯å¦æ˜¯é£ä¹¦å›¾ç‰‡
isFeishuImage(url) {
    const feishuDomains = [
        'feishu.cn',
        'larksuite.com',
        'bytedance.net',
        'lf-static.bytednsdoc.com'
    ];
    return feishuDomains.some(domain => url.includes(domain));
}

// ä»Markdownæå–æ‰€æœ‰é£ä¹¦å›¾ç‰‡
extractFeishuImages(markdown) {
    const imageRegex = /!\[([^\]]*)\]\(([^)]+)\)/g;
    const feishuImages = [];
    let match;
    
    while ((match = imageRegex.exec(markdown)) !== null) {
        const url = match[2];
        if (this.isFeishuImage(url)) {
            feishuImages.push({
                alt: match[1],
                url: url,
                originalMatch: match[0]
            });
        }
    }
    
    return feishuImages;
}
```

#### 4. å›¾ç‰‡ä¸‹è½½ä¸ä¸Šä¼ 

```javascript
// ä¸‹è½½å›¾ç‰‡
async downloadImage(url) {
    const response = await fetch(url, {
        mode: 'cors',
        credentials: 'omit'
    });
    
    const blob = await response.blob();
    const filename = `feishu_${Date.now()}_${random}.${ext}`;
    const file = new File([blob], filename, { type: blob.type });
    
    return { success: true, file, blob };
}

// ä¸Šä¼ åˆ°æœåŠ¡å™¨
async uploadToLocal(file, articleId) {
    const formData = new FormData();
    formData.append('image', file);
    formData.append('articleId', articleId);
    
    const response = await fetch('http://localhost:3001/upload/feishu/image', {
        method: 'POST',
        body: formData
    });
    
    const result = await response.json();
    return result;
}
```

#### 5. æ‰¹é‡å¤„ç†ä¸è¿›åº¦æ˜¾ç¤º

```javascript
// æ‰¹é‡å¤„ç†æ‰€æœ‰å›¾ç‰‡
async processAllImages(markdown, articleId, onProgress) {
    const feishuImages = this.extractFeishuImages(markdown);
    
    for (let i = 0; i < feishuImages.length; i++) {
        // æ›´æ–°è¿›åº¦
        onProgress({
            current: i + 1,
            total: feishuImages.length,
            currentImage: feishuImages[i].url
        });
        
        // å¤„ç†å•ä¸ªå›¾ç‰‡
        const result = await this.processImage(feishuImages[i], articleId);
        
        if (result.success) {
            // æ›¿æ¢Markdownä¸­çš„URL
            markdown = markdown.replace(
                result.original.originalMatch,
                result.newMarkdown
            );
        }
        
        // å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
        await new Promise(resolve => setTimeout(resolve, 500));
    }
    
    return { success: true, markdown };
}
```

---


## ğŸ“ è¯¦ç»†ä»£ç 

### 1. HTML ç»“æ„

å¯¼å…¥å¯¹è¯æ¡†çš„HTMLç»“æ„ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ï¼š

```html
<div class="modal-overlay" id="feishuImportModal">
    <div class="modal-content" style="max-width: 900px; width: 90%;">
        <!-- å¯¹è¯æ¡†å¤´éƒ¨ -->
        <div class="modal-header">
            <h3>ğŸ“„ å¯¼å…¥é£ä¹¦æ–‡æ¡£</h3>
            <button class="modal-close" onclick="feishuImporter.closeDialog()">Ã—</button>
        </div>
        
        <!-- å¯¹è¯æ¡†ä¸»ä½“ -->
        <div class="modal-body">
            <!-- æ–¹å¼ä¸€ï¼šURLå¯¼å…¥ï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰ -->
            <div>
                <label for="feishuUrl">
                    <h4>æ–¹å¼ä¸€ï¼šç²˜è´´é£ä¹¦æ–‡æ¡£URL</h4>
                </label>
                <input type="url" 
                       id="feishuUrl" 
                       placeholder="https://example.feishu.cn/docx/...">
                <p>âš ï¸ æ³¨æ„ï¼šéœ€è¦æ–‡æ¡£è®¾ç½®ä¸º"ä»»ä½•äººå¯æŸ¥çœ‹"æƒé™</p>
            </div>
            
            <!-- æ–¹å¼äºŒï¼šç›´æ¥ç²˜è´´å†…å®¹ï¼ˆæ¨èï¼‰ -->
            <div>
                <label for="feishuPasteArea">
                    <h4>æ–¹å¼äºŒï¼šç²˜è´´é£ä¹¦æ–‡æ¡£å†…å®¹ï¼ˆæ¨èï¼‰</h4>
                </label>
                <div id="feishuPasteArea" 
                     contenteditable="true" 
                     class="feishu-paste-area"
                     data-placeholder="ç›´æ¥ä»é£ä¹¦æ–‡æ¡£å¤åˆ¶å†…å®¹ç²˜è´´åˆ°è¿™é‡Œ...">
                </div>
            </div>
            
            <!-- å›¾ç‰‡å¤„ç†é€‰é¡¹ -->
            <div class="info-box">
                <h4>ğŸ’¡ å›¾ç‰‡å¤„ç†é€‰é¡¹</h4>
                <label>
                    <input type="radio" name="imageMode" value="upload" checked>
                    ğŸš€ è‡ªåŠ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆæ¨èï¼‰
                </label>
                <label>
                    <input type="radio" name="imageMode" value="base64">
                    ğŸ“¦ è½¬æ¢ä¸ºBase64
                </label>
                <label>
                    <input type="radio" name="imageMode" value="keep">
                    ğŸ”— ä¿ç•™é£ä¹¦å›¾ç‰‡URL
                </label>
            </div>
            
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="info-box">
                <h4>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
                <ul>
                    <li>åœ¨é£ä¹¦æ–‡æ¡£ä¸­å…¨é€‰ï¼ˆCtrl+Aï¼‰â†’ å¤åˆ¶ï¼ˆCtrl+Cï¼‰â†’ ç²˜è´´åˆ°ä¸Šæ–¹ç¼–è¾‘æ¡†</li>
                    <li>æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼ï¼šæ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€ä»£ç å—ã€è¡¨æ ¼ç­‰</li>
                    <li>è‡ªåŠ¨è¯†åˆ«æ ‡é¢˜å±‚çº§ï¼Œæ™ºèƒ½è½¬æ¢ä¸ºMarkdown</li>
                    <li>è‡ªåŠ¨å¤„ç†é£ä¹¦å›¾ç‰‡ï¼Œæ— éœ€æ‰‹åŠ¨ä¸‹è½½</li>
                </ul>
            </div>
        </div>
        
        <!-- å¯¹è¯æ¡†åº•éƒ¨ -->
        <div class="modal-footer">
            <button class="btn-secondary" onclick="feishuImporter.closeDialog()">
                å–æ¶ˆ
            </button>
            <button class="btn-primary" onclick="feishuImporter.importDocument()">
                <span id="importBtnText">ğŸ“¥ å¯¼å…¥å¹¶è½¬æ¢</span>
            </button>
        </div>
    </div>
</div>
```

### 2. CSS æ ·å¼

```css
/* ç²˜è´´åŒºåŸŸæ ·å¼ */
.feishu-paste-area {
    min-height: 300px;
    max-height: 500px;
    overflow-y: auto;
    border: 2px dashed #4fc3f7;
    border-radius: 8px;
    padding: 1.5rem;
    background: #f8f9fa;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    line-height: 1.6;
    transition: all 0.3s;
}

.feishu-paste-area:focus {
    outline: none;
    border-color: #2196f3;
    background: white;
    box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
}

.feishu-paste-area:empty:before {
    content: attr(data-placeholder);
    color: #999;
    font-style: italic;
}

/* ä¿¡æ¯æç¤ºæ¡† */
.info-box {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-left: 4px solid #2196f3;
    padding: 1.5rem;
    border-radius: 8px;
    margin-top: 1.5rem;
}

.info-box h4 {
    color: #1976d2;
    margin-bottom: 1rem;
    font-size: 1.1rem;
}

.info-box ul {
    margin-left: 1.5rem;
    color: #555;
}

.info-box li {
    margin-bottom: 0.5rem;
}

/* å•é€‰æŒ‰é’®æ ·å¼ */
.info-box label {
    display: block;
    margin: 0.8rem 0;
    padding: 0.8rem 1rem;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
}

.info-box label:hover {
    background: #e3f2fd;
    transform: translateX(5px);
}

.info-box input[type="radio"] {
    margin-right: 0.5rem;
}

/* è¿›åº¦å¯¹è¯æ¡†æ ·å¼ */
#feishuImageProgress {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    z-index: 10000;
    min-width: 400px;
}

#feishuImageProgress h3 {
    margin: 0 0 1rem 0;
    color: #2c5f7c;
    font-size: 1.3rem;
}

#progressInfo {
    margin-bottom: 1rem;
    color: #666;
    font-weight: 500;
}

#progressBar {
    background: linear-gradient(90deg, #4fc3f7, #2196f3);
    height: 100%;
    width: 0%;
    transition: width 0.3s;
    border-radius: 4px;
}

#currentImage {
    margin-top: 1rem;
    font-size: 0.85rem;
    color: #999;
    word-break: break-all;
    max-height: 60px;
    overflow: hidden;
}

/* é®ç½©å±‚ */
#feishuImageOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
}

/* é€šçŸ¥æ ·å¼ */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 100000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.notification.success { background: #4caf50; }
.notification.error { background: #f44336; }
.notification.warning { background: #ff9800; }
.notification.info { background: #2196f3; }
```

### 3. JavaScript æ ¸å¿ƒä»£ç 

#### 3.1 FeishuImporter ç±»ï¼ˆä¸»å¯¼å…¥å™¨ï¼‰

```javascript
class FeishuImporter {
    constructor() {
        this.modal = null;
    }
    
    // æ˜¾ç¤ºå¯¼å…¥å¯¹è¯æ¡†
    showImportDialog() {
        // åˆ›å»ºæ¨¡æ€æ¡†HTMLï¼ˆè§ä¸Šæ–¹HTMLç»“æ„ï¼‰
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        this.modal = document.getElementById('feishuImportModal');
        
        // ç›‘å¬ç²˜è´´äº‹ä»¶ï¼Œä¿ç•™å¯Œæ–‡æœ¬æ ¼å¼
        const pasteArea = document.getElementById('feishuPasteArea');
        pasteArea.addEventListener('paste', (e) => {
            const clipboardData = e.clipboardData || window.clipboardData;
            const htmlData = clipboardData.getData('text/html');
            
            if (htmlData) {
                e.preventDefault();
                const temp = document.createElement('div');
                temp.innerHTML = htmlData;
                pasteArea.appendChild(temp);
            }
        });
    }
    
    // å¯¼å…¥æ–‡æ¡£
    async importDocument() {
        const pasteArea = document.getElementById('feishuPasteArea');
        
        // è½¬æ¢HTMLä¸ºMarkdown
        let markdown = await this.convertHtmlToMarkdown(pasteArea);
        
        // è·å–å›¾ç‰‡å¤„ç†æ¨¡å¼
        const imageMode = document.querySelector('input[name="imageMode"]:checked').value;
        
        // æ£€æµ‹é£ä¹¦å›¾ç‰‡
        const feishuImages = window.feishuImageDownloader.extractFeishuImages(markdown);
        
        if (feishuImages.length > 0 && imageMode === 'upload') {
            // è‡ªåŠ¨ä¸Šä¼ æ¨¡å¼
            const articleId = 'article_' + Date.now();
            const progressDialog = window.feishuImageDownloader.showProgressDialog();
            
            const result = await window.feishuImageDownloader.processAllImages(
                markdown,
                articleId,
                (progress) => {
                    progressDialog.updateProgress(progress.current, progress.total);
                    progressDialog.updateCurrentImage(progress.currentImage);
                }
            );
            
            progressDialog.close();
            markdown = result.markdown;
        }
        
        // ä¿å­˜è‰ç¨¿å¹¶è·³è½¬
        const articleDraft = {
            title: this.extractTitle(markdown) || 'ä»é£ä¹¦å¯¼å…¥çš„æ–‡ç« ',
            content: markdown,
            savedAt: new Date().toISOString(),
            source: 'feishu'
        };
        
        localStorage.setItem('article_draft', JSON.stringify(articleDraft));
        window.location.href = 'pages/editor.html';
    }
    
    // HTMLè½¬Markdownï¼ˆæ ¸å¿ƒè½¬æ¢é€»è¾‘ï¼‰
    async convertHtmlToMarkdown(element) {
        let markdown = '';
        
        const processNode = async (node) => {
            if (node.nodeType === Node.TEXT_NODE) {
                return node.textContent || '';
            }
            
            if (node.nodeType !== Node.ELEMENT_NODE) {
                return '';
            }
            
            const tagName = node.tagName.toLowerCase();
            let result = '';
            
            switch (tagName) {
                case 'h1': return '# ' + node.textContent.trim() + '\n\n';
                case 'h2': return '## ' + node.textContent.trim() + '\n\n';
                case 'h3': return '### ' + node.textContent.trim() + '\n\n';
                
                case 'p':
                case 'div':
                    // æ™ºèƒ½è¯†åˆ«æ ‡é¢˜
                    const style = window.getComputedStyle(node);
                    const fontSize = parseFloat(style.fontSize);
                    const fontWeight = style.fontWeight;
                    let text = node.textContent.trim();
                    
                    if (text.length > 0 && text.length < 100) {
                        let headingLevel = null;
                        
                        if (fontSize >= 26) {
                            headingLevel = 1;
                        } else if (fontSize >= 20) {
                            headingLevel = 2;
                        } else if (fontSize >= 16 && fontWeight >= 600) {
                            headingLevel = 3;
                        }
                        
                        if (headingLevel) {
                            // æ¸…ç†åºå·
                            text = text
                                .replace(/^\d+\.\d+\.\d+[\s\u3000]+/, '')
                                .replace(/^\d+\.\d+[\s\u3000]+/, '')
                                .replace(/^\d+\.[\s\u3000]+/, '')
                                .trim();
                            
                            return '#'.repeat(headingLevel) + ' ' + text + '\n\n';
                        }
                    }
                    
                    return text + '\n\n';
                
                case 'img':
                    const src = node.getAttribute('src') || '';
                    const alt = node.getAttribute('alt') || 'å›¾ç‰‡';
                    return '![' + alt + '](' + src + ')\n\n';
                
                case 'strong':
                case 'b':
                    return '**' + node.textContent.trim() + '**';
                
                case 'em':
                case 'i':
                    return '*' + node.textContent.trim() + '*';
                
                case 'code':
                    if (node.parentElement.tagName === 'PRE') {
                        return '```\n' + node.textContent + '\n```\n\n';
                    }
                    return '`' + node.textContent + '`';
                
                case 'ul':
                    for (let child of node.children) {
                        result += '- ' + child.textContent.trim() + '\n';
                    }
                    return result + '\n';
                
                case 'ol':
                    let index = 1;
                    for (let child of node.children) {
                        result += index + '. ' + child.textContent.trim() + '\n';
                        index++;
                    }
                    return result + '\n';
                
                default:
                    for (let child of node.childNodes) {
                        result += await processNode(child);
                    }
                    return result;
            }
        };
        
        for (let child of element.childNodes) {
            markdown += await processNode(child);
        }
        
        return markdown.trim();
    }
    
    // æå–æ ‡é¢˜
    extractTitle(markdown) {
        const lines = markdown.split('\n');
        for (const line of lines) {
            const match = line.match(/^#\s+(.+)$/);
            if (match) {
                return match[1].trim();
            }
        }
        return null;
    }
}
```

#### 3.2 FeishuImageDownloader ç±»ï¼ˆå›¾ç‰‡å¤„ç†å™¨ï¼‰

```javascript
class FeishuImageDownloader {
    constructor() {
        this.feishuDomains = [
            'feishu.cn',
            'larksuite.com',
            'bytedance.net',
            'lf-static.bytednsdoc.com'
        ];
    }
    
    // æ£€æµ‹æ˜¯å¦æ˜¯é£ä¹¦å›¾ç‰‡
    isFeishuImage(url) {
        return this.feishuDomains.some(domain => url.includes(domain));
    }
    
    // æå–æ‰€æœ‰é£ä¹¦å›¾ç‰‡
    extractFeishuImages(markdown) {
        const imageRegex = /!\[([^\]]*)\]\(([^)]+)\)/g;
        const feishuImages = [];
        let match;
        
        while ((match = imageRegex.exec(markdown)) !== null) {
            const url = match[2];
            if (this.isFeishuImage(url)) {
                feishuImages.push({
                    alt: match[1],
                    url: url,
                    originalMatch: match[0]
                });
            }
        }
        
        return feishuImages;
    }
    
    // ä¸‹è½½å›¾ç‰‡
    async downloadImage(url) {
        const response = await fetch(url, {
            mode: 'cors',
            credentials: 'omit'
        });
        
        const blob = await response.blob();
        const timestamp = Date.now();
        const random = Math.random().toString(36).substring(2, 8);
        const ext = this.getImageExtension(blob.type);
        const filename = `feishu_${timestamp}_${random}${ext}`;
        const file = new File([blob], filename, { type: blob.type });
        
        return { success: true, file, blob };
    }
    
    // ä¸Šä¼ åˆ°æœåŠ¡å™¨
    async uploadToLocal(file, articleId) {
        const formData = new FormData();
        formData.append('image', file);
        formData.append('articleId', articleId);
        
        const response = await fetch('http://localhost:3001/upload/feishu/image', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        return result;
    }
    
    // å¤„ç†å•ä¸ªå›¾ç‰‡
    async processImage(imageInfo, articleId) {
        // 1. ä¸‹è½½å›¾ç‰‡
        const downloadResult = await this.downloadImage(imageInfo.url);
        if (!downloadResult.success) {
            return { success: false, error: downloadResult.error };
        }
        
        // 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
        const uploadResult = await this.uploadToLocal(downloadResult.file, articleId);
        
        // 3. è¿”å›æ–°URL
        return {
            success: true,
            original: imageInfo,
            newUrl: uploadResult.url,
            newMarkdown: `![${imageInfo.alt}](${uploadResult.url})`
        };
    }
    
    // æ‰¹é‡å¤„ç†æ‰€æœ‰å›¾ç‰‡
    async processAllImages(markdown, articleId, onProgress) {
        const feishuImages = this.extractFeishuImages(markdown);
        let successCount = 0;
        
        for (let i = 0; i < feishuImages.length; i++) {
            // æ›´æ–°è¿›åº¦
            onProgress({
                current: i + 1,
                total: feishuImages.length,
                currentImage: feishuImages[i].url
            });
            
            // å¤„ç†å›¾ç‰‡
            const result = await this.processImage(feishuImages[i], articleId);
            
            if (result.success) {
                successCount++;
                // æ›¿æ¢Markdownä¸­çš„URL
                markdown = markdown.replace(
                    result.original.originalMatch,
                    result.newMarkdown
                );
            }
            
            // å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
            await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        return {
            success: true,
            markdown: markdown,
            processed: successCount,
            total: feishuImages.length
        };
    }
    
    // æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†
    showProgressDialog() {
        const dialog = document.createElement('div');
        dialog.id = 'feishuImageProgress';
        dialog.innerHTML = `
            <h3>æ­£åœ¨å¤„ç†é£ä¹¦å›¾ç‰‡</h3>
            <div id="progressInfo">å‡†å¤‡ä¸­...</div>
            <div style="background: #f0f0f0; height: 8px; border-radius: 4px;">
                <div id="progressBar" style="width: 0%;"></div>
            </div>
            <div id="currentImage"></div>
        `;
        
        const overlay = document.createElement('div');
        overlay.id = 'feishuImageOverlay';
        
        document.body.appendChild(overlay);
        document.body.appendChild(dialog);
        
        return {
            updateProgress: (current, total) => {
                const percent = (current / total * 100).toFixed(0);
                document.getElementById('progressBar').style.width = percent + '%';
                document.getElementById('progressInfo').textContent = 
                    `æ­£åœ¨å¤„ç†: ${current} / ${total} (${percent}%)`;
            },
            updateCurrentImage: (url) => {
                document.getElementById('currentImage').textContent = `å½“å‰: ${url}`;
            },
            close: () => {
                overlay.remove();
                dialog.remove();
            }
        };
    }
}
```

#### 3.3 æœåŠ¡å™¨ç«¯ä»£ç ï¼ˆNode.js + Expressï¼‰

```javascript
// unified-server.js
const express = require('express');
const multer = require('multer');
const path = require('path');

const app = express();
const PORT = 3001;

// é…ç½®æ–‡ä»¶ä¸Šä¼ 
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        cb(null, 'uploads/images/upload');
    },
    filename: (req, file, cb) => {
        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
        const ext = path.extname(file.originalname);
        cb(null, 'img-' + uniqueSuffix + ext);
    }
});

const upload = multer({
    storage: storage,
    limits: { fileSize: 10 * 1024 * 1024 }, // 10MB
    fileFilter: (req, file, cb) => {
        const allowedTypes = /jpeg|jpg|png|gif|webp|svg/;
        const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());
        const mimetype = allowedTypes.test(file.mimetype);
        
        if (mimetype && extname) {
            cb(null, true);
        } else {
            cb(new Error('åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼'));
        }
    }
});

// é£ä¹¦å›¾ç‰‡ä¸Šä¼ æ¥å£
app.post('/upload/feishu/image', upload.single('image'), (req, res) => {
    if (!req.file) {
        return res.status(400).json({
            success: false,
            message: 'æ²¡æœ‰ä¸Šä¼ æ–‡ä»¶'
        });
    }
    
    const fileUrl = `uploads/images/upload/${req.file.filename}`;
    res.json({
        success: true,
        message: 'é£ä¹¦å›¾ç‰‡ä¸Šä¼ æˆåŠŸ',
        data: {
            filename: req.file.filename,
            url: fileUrl,
            fullUrl: `http://localhost:${PORT}/${fileUrl}`
        }
    });
});

// å¯åŠ¨æœåŠ¡å™¨
app.listen(PORT, () => {
    console.log(`ğŸš€ æœåŠ¡å™¨å·²å¯åŠ¨: http://localhost:${PORT}`);
});
```

---


## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‰ç½®æ¡ä»¶

1. **å¯åŠ¨æœåŠ¡å™¨**ï¼ˆè‡ªåŠ¨ä¸Šä¼ æ¨¡å¼éœ€è¦ï¼‰

```bash
# æ–¹å¼1ï¼šä¸€é”®å¯åŠ¨
ğŸš€-ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡.bat

# æ–¹å¼2ï¼šæ‰‹åŠ¨å¯åŠ¨
node unified-server.js
```

2. **ç¡®è®¤æœåŠ¡å™¨è¿è¡Œ**

è®¿é—® http://localhost:3001/api/health åº”è¯¥è¿”å›ï¼š
```json
{
  "success": true,
  "message": "ç»Ÿä¸€æœåŠ¡å™¨è¿è¡Œæ­£å¸¸"
}
```

### æ“ä½œæ­¥éª¤

#### æ­¥éª¤1ï¼šæ‰“å¼€é£ä¹¦æ–‡æ¡£

åœ¨é£ä¹¦ä¸­æ‰“å¼€è¦å¯¼å…¥çš„æ–‡æ¡£ã€‚

#### æ­¥éª¤2ï¼šå¤åˆ¶æ–‡æ¡£å†…å®¹

- å…¨é€‰ï¼š`Ctrl + A` (Windows) æˆ– `Cmd + A` (Mac)
- å¤åˆ¶ï¼š`Ctrl + C` (Windows) æˆ– `Cmd + C` (Mac)

#### æ­¥éª¤3ï¼šæ‰“å¼€å¯¼å…¥å¯¹è¯æ¡†

åœ¨åšå®¢åå°ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»"å¯¼å…¥é£ä¹¦"æŒ‰é’®ã€‚

```javascript
// æˆ–é€šè¿‡ä»£ç è°ƒç”¨
window.feishuImporter.showImportDialog();
```

#### æ­¥éª¤4ï¼šç²˜è´´å†…å®¹

åœ¨å¯¼å…¥å¯¹è¯æ¡†çš„ç¼–è¾‘åŒºåŸŸç²˜è´´ï¼š`Ctrl + V` (Windows) æˆ– `Cmd + V` (Mac)

#### æ­¥éª¤5ï¼šé€‰æ‹©å›¾ç‰‡å¤„ç†æ¨¡å¼

- **ğŸš€ è‡ªåŠ¨ä¸Šä¼ **ï¼ˆæ¨èï¼‰ï¼šè‡ªåŠ¨ä¸‹è½½å¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨
- **ğŸ“¦ Base64**ï¼šè½¬æ¢ä¸ºBase64åµŒå…¥
- **ğŸ”— ä¿ç•™URL**ï¼šä¿ç•™é£ä¹¦åŸå§‹é“¾æ¥

#### æ­¥éª¤6ï¼šç‚¹å‡»å¯¼å…¥

ç‚¹å‡»"ğŸ“¥ å¯¼å…¥å¹¶è½¬æ¢"æŒ‰é’®ï¼Œç­‰å¾…å¤„ç†å®Œæˆã€‚

#### æ­¥éª¤7ï¼šç¼–è¾‘å™¨ä¸­è°ƒæ•´

è‡ªåŠ¨è·³è½¬åˆ°ç¼–è¾‘å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´å†…å®¹ã€‚

---

## ğŸ¨ æ•ˆæœå±•ç¤º

### 1. å¯¼å…¥å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ å¯¼å…¥é£ä¹¦æ–‡æ¡£                                  Ã—  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  æ–¹å¼ä¸€ï¼šç²˜è´´é£ä¹¦æ–‡æ¡£URL                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ https://example.feishu.cn/docx/...          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  âš ï¸ æ³¨æ„ï¼šéœ€è¦æ–‡æ¡£è®¾ç½®ä¸º"ä»»ä½•äººå¯æŸ¥çœ‹"æƒé™           â”‚
â”‚                                                       â”‚
â”‚  æ–¹å¼äºŒï¼šç²˜è´´é£ä¹¦æ–‡æ¡£å†…å®¹ï¼ˆæ¨èï¼‰                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                               â”‚    â”‚
â”‚  â”‚  ç›´æ¥ä»é£ä¹¦æ–‡æ¡£å¤åˆ¶å†…å®¹ç²˜è´´åˆ°è¿™é‡Œ...          â”‚    â”‚
â”‚  â”‚                                               â”‚    â”‚
â”‚  â”‚                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                       â”‚
â”‚  ğŸ’¡ å›¾ç‰‡å¤„ç†é€‰é¡¹                                      â”‚
â”‚  â—‹ ğŸš€ è‡ªåŠ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆæ¨èï¼‰                        â”‚
â”‚  â—‹ ğŸ“¦ è½¬æ¢ä¸ºBase64                                   â”‚
â”‚  â—‹ ğŸ”— ä¿ç•™é£ä¹¦å›¾ç‰‡URL                                â”‚
â”‚                                                       â”‚
â”‚  ğŸ’¡ ä½¿ç”¨è¯´æ˜                                          â”‚
â”‚  â€¢ åœ¨é£ä¹¦æ–‡æ¡£ä¸­å…¨é€‰ï¼ˆCtrl+Aï¼‰â†’ å¤åˆ¶ï¼ˆCtrl+Cï¼‰       â”‚
â”‚  â€¢ æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼ï¼šæ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€ä»£ç å—ç­‰        â”‚
â”‚  â€¢ è‡ªåŠ¨è¯†åˆ«æ ‡é¢˜å±‚çº§ï¼Œæ™ºèƒ½è½¬æ¢ä¸ºMarkdown             â”‚
â”‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          [å–æ¶ˆ]  [ğŸ“¥ å¯¼å…¥å¹¶è½¬æ¢]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å›¾ç‰‡å¤„ç†è¿›åº¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­£åœ¨å¤„ç†é£ä¹¦å›¾ç‰‡                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  æ­£åœ¨å¤„ç†: 3 / 5 (60%)                               â”‚
â”‚                                                       â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                              â”‚
â”‚                                                       â”‚
â”‚  å½“å‰: https://feishu.cn/space/api/box/...          â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. è½¬æ¢å‰åå¯¹æ¯”

#### é£ä¹¦æ–‡æ¡£åŸå§‹å†…å®¹ï¼š

```
1. é¡¹ç›®ä»‹ç»

è¿™æ˜¯ä¸€ä¸ªåšå®¢ç³»ç»Ÿçš„ä»‹ç»æ–‡æ¡£ã€‚

1.1 æ ¸å¿ƒåŠŸèƒ½

æ”¯æŒæ–‡ç« ç®¡ç†ã€åˆ†ç±»æ ‡ç­¾ã€è¯„è®ºç³»ç»Ÿç­‰åŠŸèƒ½ã€‚

[å›¾ç‰‡ï¼šç³»ç»Ÿæ¶æ„å›¾]

1.2 æŠ€æœ¯æ ˆ

â€¢ å‰ç«¯ï¼šHTMLã€CSSã€JavaScript
â€¢ åç«¯ï¼šNode.jsã€Express
â€¢ æ•°æ®åº“ï¼šJSONæ–‡ä»¶å­˜å‚¨
```

#### è½¬æ¢åçš„ Markdownï¼š

```markdown
# é¡¹ç›®ä»‹ç»

è¿™æ˜¯ä¸€ä¸ªåšå®¢ç³»ç»Ÿçš„ä»‹ç»æ–‡æ¡£ã€‚

## æ ¸å¿ƒåŠŸèƒ½

æ”¯æŒæ–‡ç« ç®¡ç†ã€åˆ†ç±»æ ‡ç­¾ã€è¯„è®ºç³»ç»Ÿç­‰åŠŸèƒ½ã€‚

![ç³»ç»Ÿæ¶æ„å›¾](uploads/images/upload/img-1234567890.jpg)

## æŠ€æœ¯æ ˆ

- å‰ç«¯ï¼šHTMLã€CSSã€JavaScript
- åç«¯ï¼šNode.jsã€Express
- æ•°æ®åº“ï¼šJSONæ–‡ä»¶å­˜å‚¨
```

### 4. æˆåŠŸé€šçŸ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… é£ä¹¦å›¾ç‰‡å·²è‡ªåŠ¨ä¸Šä¼ ï¼             â”‚
â”‚  æˆåŠŸ: 5, å¤±è´¥: 0                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å›¾ç‰‡æ— æ³•ä¸‹è½½æ€ä¹ˆåŠï¼Ÿ

**åŸå› ï¼š** é£ä¹¦å›¾ç‰‡å¯èƒ½æœ‰è®¿é—®æƒé™é™åˆ¶ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿é£ä¹¦æ–‡æ¡£è®¾ç½®ä¸º"ä»»ä½•äººå¯æŸ¥çœ‹"
2. ä½¿ç”¨ Base64 æ¨¡å¼ï¼ˆä¼šå ç”¨å­˜å‚¨ç©ºé—´ï¼‰
3. æ‰‹åŠ¨ä¸‹è½½å›¾ç‰‡åä¸Šä¼ 

### Q2: æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Ÿ

**åŸå› ï¼š** ç«¯å£è¢«å ç”¨æˆ– Node.js æœªå®‰è£…ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :3001

# å…³é—­å ç”¨è¿›ç¨‹
taskkill /F /PID <è¿›ç¨‹ID>

# é‡æ–°å¯åŠ¨
node unified-server.js
```

### Q3: æ ‡é¢˜è¯†åˆ«ä¸å‡†ç¡®ï¼Ÿ

**åŸå› ï¼š** é£ä¹¦æ–‡æ¡£çš„æ ·å¼å¯èƒ½ä¸æ ‡å‡†ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1. åœ¨é£ä¹¦ä¸­ä½¿ç”¨æ ‡å‡†çš„æ ‡é¢˜æ ·å¼ï¼ˆH1ã€H2ã€H3ï¼‰
2. å¯¼å…¥ååœ¨ç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨è°ƒæ•´
3. è°ƒæ•´ä»£ç ä¸­çš„å­—ä½“å¤§å°é˜ˆå€¼

### Q4: å›¾ç‰‡å¤ªå¤§å¯¼è‡´ä¸Šä¼ å¤±è´¥ï¼Ÿ

**åŸå› ï¼š** å›¾ç‰‡è¶…è¿‡ 10MB é™åˆ¶ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1. åœ¨é£ä¹¦ä¸­å‹ç¼©å›¾ç‰‡
2. ä¿®æ”¹æœåŠ¡å™¨é…ç½®å¢åŠ é™åˆ¶ï¼š
```javascript
const upload = multer({
    limits: { fileSize: 20 * 1024 * 1024 } // æ”¹ä¸º 20MB
});
```

### Q5: è½¬æ¢åæ ¼å¼ä¸¢å¤±ï¼Ÿ

**åŸå› ï¼š** æŸäº›ç‰¹æ®Šæ ¼å¼å¯èƒ½ä¸æ”¯æŒã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨ Markdown æ”¯æŒçš„æ ¼å¼
2. åœ¨ç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨è°ƒæ•´
3. æ‰©å±•è½¬æ¢å™¨æ”¯æŒæ›´å¤šæ ¼å¼

### Q6: Base64 æ¨¡å¼å ç”¨ç©ºé—´å¤ªå¤§ï¼Ÿ

**åŸå› ï¼š** å›¾ç‰‡è½¬æ¢ä¸º Base64 åä½“ç§¯å¢å¤§çº¦ 33%ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨è‡ªåŠ¨ä¸Šä¼ æ¨¡å¼ï¼ˆæ¨èï¼‰
2. å‹ç¼©å›¾ç‰‡åå†å¯¼å…¥
3. ä½¿ç”¨å›¾åºŠæœåŠ¡

---

## ğŸ”§ é«˜çº§é…ç½®

### 1. ä¿®æ”¹å›¾ç‰‡å¤§å°é™åˆ¶

```javascript
// unified-server.js
const upload = multer({
    limits: {
        fileSize: 20 * 1024 * 1024 // æ”¹ä¸º 20MB
    }
});
```

### 2. è‡ªå®šä¹‰é£ä¹¦åŸŸå

```javascript
// feishu-image-downloader.js
constructor() {
    this.feishuDomains = [
        'feishu.cn',
        'larksuite.com',
        'your-custom-domain.com' // æ·»åŠ è‡ªå®šä¹‰åŸŸå
    ];
}
```

### 3. è°ƒæ•´æ ‡é¢˜è¯†åˆ«é˜ˆå€¼

```javascript
// feishu-importer.js
if (fontSize >= 28) {        // åŸæ¥æ˜¯ 26
    headingLevel = 1;
} else if (fontSize >= 22) {  // åŸæ¥æ˜¯ 20
    headingLevel = 2;
} else if (fontSize >= 18) {  // åŸæ¥æ˜¯ 16
    headingLevel = 3;
}
```

### 4. ä¿®æ”¹å›¾ç‰‡å­˜å‚¨è·¯å¾„

```javascript
// unified-server.js
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        // è‡ªå®šä¹‰å­˜å‚¨è·¯å¾„
        cb(null, 'custom/path/to/images');
    }
});
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶å‘ä¸‹è½½å›¾ç‰‡

```javascript
// ä½¿ç”¨ Promise.all å¹¶å‘ä¸‹è½½
async processAllImages(markdown, articleId) {
    const feishuImages = this.extractFeishuImages(markdown);
    
    // å¹¶å‘ä¸‹è½½ï¼ˆé™åˆ¶å¹¶å‘æ•°ä¸º 3ï¼‰
    const chunks = [];
    for (let i = 0; i < feishuImages.length; i += 3) {
        chunks.push(feishuImages.slice(i, i + 3));
    }
    
    for (const chunk of chunks) {
        const results = await Promise.all(
            chunk.map(img => this.processImage(img, articleId))
        );
        // å¤„ç†ç»“æœ...
    }
}
```

### 2. å›¾ç‰‡å‹ç¼©

```javascript
// ä½¿ç”¨ Canvas å‹ç¼©å›¾ç‰‡
async compressImage(blob, maxWidth = 1920) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            canvas.toBlob(resolve, 'image/jpeg', 0.85);
        };
        img.src = URL.createObjectURL(blob);
    });
}
```

### 3. ç¼“å­˜å·²ä¸‹è½½çš„å›¾ç‰‡

```javascript
class FeishuImageDownloader {
    constructor() {
        this.imageCache = new Map(); // æ·»åŠ ç¼“å­˜
    }
    
    async downloadImage(url) {
        // æ£€æŸ¥ç¼“å­˜
        if (this.imageCache.has(url)) {
            return this.imageCache.get(url);
        }
        
        // ä¸‹è½½å›¾ç‰‡
        const result = await this.downloadImageFromUrl(url);
        
        // å­˜å…¥ç¼“å­˜
        this.imageCache.set(url, result);
        
        return result;
    }
}
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ–‡æ¡£å‡†å¤‡

- âœ… ä½¿ç”¨æ ‡å‡†çš„æ ‡é¢˜æ ·å¼ï¼ˆH1ã€H2ã€H3ï¼‰
- âœ… å›¾ç‰‡å¤§å°æ§åˆ¶åœ¨ 5MB ä»¥å†…
- âœ… é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ä½œä¸ºæ ‡é¢˜
- âœ… ä»£ç å—ä½¿ç”¨é£ä¹¦çš„ä»£ç å—åŠŸèƒ½

### 2. å¯¼å…¥æ“ä½œ

- âœ… ä¼˜å…ˆä½¿ç”¨"è‡ªåŠ¨ä¸Šä¼ "æ¨¡å¼
- âœ… å›¾ç‰‡è¾ƒå¤šæ—¶åˆ†æ‰¹å¯¼å…¥
- âœ… å¯¼å…¥å‰ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨
- âœ… å¯¼å…¥åæ£€æŸ¥å›¾ç‰‡æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

### 3. åç»­å¤„ç†

- âœ… åœ¨ç¼–è¾‘å™¨ä¸­æ£€æŸ¥æ ¼å¼
- âœ… è°ƒæ•´å›¾ç‰‡å¤§å°å’Œä½ç½®
- âœ… æ·»åŠ å¿…è¦çš„è¯´æ˜æ–‡å­—
- âœ… é¢„è§ˆåå†å‘å¸ƒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é£ä¹¦å¯¼å…¥å¿«é€Ÿå¼€å§‹](FEISHU-QUICK-START.md)
- [å›¾ç‰‡å¤„ç†æŒ‡å—](IMAGE-HANDLING-GUIDE.md)
- [Markdown ç¼–è¾‘å™¨æŒ‡å—](MARKDOWN-EDITOR-GUIDE.md)
- [æœåŠ¡å™¨è®¾ç½®æŒ‡å—](SERVER-SETUP-GUIDE.md)

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v2.0.0 (2025-11-23)
- âœ¨ æ–°å¢è‡ªåŠ¨ä¸Šä¼ æ¨¡å¼
- âœ¨ æ–°å¢è¿›åº¦æ˜¾ç¤ºå¯¹è¯æ¡†
- âœ¨ ä¼˜åŒ–æ ‡é¢˜è¯†åˆ«ç®—æ³•
- âœ¨ æ”¯æŒåºå·è‡ªåŠ¨æ¸…ç†
- ğŸ› ä¿®å¤å›¾ç‰‡ä¸‹è½½å¤±è´¥é—®é¢˜
- ğŸ› ä¿®å¤Base64è½¬æ¢è¶…æ—¶é—®é¢˜

### v1.0.0 (2025-11-18)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒå¯Œæ–‡æœ¬ç²˜è´´
- âœ… æ”¯æŒMarkdownè½¬æ¢
- âœ… æ”¯æŒBase64å›¾ç‰‡

---

## ğŸ’¬ åé¦ˆä¸æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿ï¼š

- ğŸ“§ æäº¤ Issue
- ğŸ’¬ åœ¨çº¿è®¨è®º
- ğŸ“ è´¡çŒ®ä»£ç 

---

<div align="center">

**ğŸ‰ äº«å—é£ä¹¦æ–‡æ¡£å¯¼å…¥çš„ä¾¿æ·ä½“éªŒï¼**

Made with â¤ï¸ by â„³à¦æ‰§å¿µê¦¿

</div>
