# 📦 数据迁移完整指南

从 localStorage 迁移到 Node.js + JSON 文件系统

---

## 🎯 迁移目标

将博客数据从浏览器的 localStorage 迁移到服务器端的 JSON 文件，实现：
- ✅ 数据持久化（不会因清除浏览器缓存而丢失）
- ✅ 易于备份和恢复
- ✅ 支持版本控制（Git）
- ✅ 多设备访问
- ✅ 数据导入导出

---

## 🚀 快速开始（推荐）

### 方法一：自动迁移（最简单）

1. **启动API服务器**
   ```bash
   # 双击运行
   start-api-server.bat
   
   # 或命令行
   node api-server.js
   ```

2. **打开自动导出工具**
   ```
   http://localhost:8080/auto-export-data.html
   ```

3. **按步骤操作**
   - 点击"扫描数据" - 查看现有数据
   - 点击"导出到服务器" - 自动保存到JSON文件
   - 点击"验证数据" - 确认迁移成功

4. **完成！** 🎉

---

## 📋 方法二：手动迁移

### 步骤1：导出数据

1. 打开导出工具：
   ```
   http://localhost:8080/export-localstorage-data.html
   ```

2. 点击"导出所有数据"按钮

3. 浏览器会下载12个JSON文件：
   - articles.json
   - categories.json
   - tags.json
   - comments.json
   - guestbook.json
   - users.json
   - settings.json
   - images.json
   - music.json
   - videos.json
   - links.json
   - events.json

### 步骤2：移动文件

将下载的所有JSON文件移动到项目的 `data/` 文件夹中

### 步骤3：启动API服务器

```bash
node api-server.js
```

### 步骤4：测试验证

打开测试页面：
```
http://localhost:8080/test-api-migration.html
```

按顺序测试：
1. 检查API服务器
2. 测试数据读取
3. 测试数据写入
4. 对比localStorage数据

---

## 📁 数据结构

```
项目根目录/
├── data/                      # 数据文件夹
│   ├── articles.json         # 文章数据
│   ├── categories.json       # 分类数据
│   ├── tags.json            # 标签数据
│   ├── comments.json        # 评论数据
│   ├── guestbook.json       # 留言数据
│   ├── users.json           # 用户数据
│   ├── settings.json        # 系统设置
│   ├── images.json          # 图片数据
│   ├── music.json           # 音乐数据
│   ├── videos.json          # 视频数据
│   ├── links.json           # 友链数据
│   └── events.json          # 事项数据
├── api-server.js             # API服务器
├── blog-admin/
│   └── js/
│       └── api-client.js     # API客户端
└── ...
```

---

## 🔧 API接口说明

### 基础CRUD

所有资源都支持标准的CRUD操作：

```javascript
// 获取所有
GET /api/articles

// 获取单个
GET /api/articles/:id

// 创建
POST /api/articles
Body: { title: "标题", content: "内容", ... }

// 更新
PUT /api/articles/:id
Body: { title: "新标题", ... }

// 删除
DELETE /api/articles/:id
```

### 批量导入

```javascript
// 批量导入（覆盖整个文件）
POST /api/articles/batch
Body: [{ id: "1", title: "文章1" }, { id: "2", title: "文章2" }]
```

### 健康检查

```javascript
GET /api/health
```

---

## 💡 使用API客户端

后台管理已经集成了API客户端，使用方法：

```javascript
// 获取文章
const articles = await apiClient.getArticles();

// 创建文章
const newArticle = await apiClient.createArticle({
    title: '新文章',
    content: '内容',
    category: '分类',
    tags: ['标签1', '标签2']
});

// 更新文章
const updated = await apiClient.updateArticle(id, {
    title: '更新后的标题'
});

// 删除文章
await apiClient.deleteArticle(id);

// 获取分类
const categories = await apiClient.getCategories();

// 获取标签
const tags = await apiClient.getTags();
```

---

## 🔄 数据备份

### 自动备份

```bash
# 复制整个data文件夹
xcopy data data-backup-20231123 /E /I
```

### Git版本控制

```bash
# 初始化Git（如果还没有）
git init

# 添加data文件夹到版本控制
git add data/
git commit -m "备份数据"
```

---

## ⚠️ 注意事项

1. **API服务器必须运行**
   - 后台管理需要API服务器才能工作
   - 使用 `node api-server.js` 启动

2. **端口占用**
   - API服务器默认使用3001端口
   - 如果端口被占用，修改 `api-server.js` 中的 `PORT` 变量

3. **数据安全**
   - 定期备份 `data/` 文件夹
   - 重要数据建议使用Git版本控制

4. **性能优化**
   - 大量数据时考虑添加缓存
   - 可以使用数据库替代JSON文件

---

## 🐛 故障排除

### 问题1：API服务器无法启动

**原因：** 端口被占用或Node.js未安装

**解决：**
```bash
# 检查Node.js版本
node --version

# 检查端口占用
netstat -ano | findstr :3001

# 修改端口（在api-server.js中）
const PORT = 3002;
```

### 问题2：数据读取失败

**原因：** JSON文件格式错误或不存在

**解决：**
1. 检查 `data/` 文件夹是否存在
2. 检查JSON文件格式是否正确
3. 重新导出数据

### 问题3：CORS错误

**原因：** 跨域请求被阻止

**解决：** API服务器已配置CORS，确保使用正确的URL

---

## 📊 迁移检查清单

- [ ] 已安装Node.js
- [ ] 已创建data文件夹
- [ ] 已导出所有localStorage数据
- [ ] 已将JSON文件移动到data文件夹
- [ ] API服务器可以正常启动
- [ ] 测试页面验证通过
- [ ] 后台管理功能正常
- [ ] 已备份数据

---

## 🎉 迁移完成后

1. **测试所有功能**
   - 文章管理
   - 分类标签
   - 评论留言
   - 媒体库
   - 用户管理

2. **设置自动备份**
   - 定期备份data文件夹
   - 使用Git版本控制

3. **优化性能**
   - 添加缓存机制
   - 考虑使用数据库

4. **部署到服务器**
   - 配置生产环境
   - 设置域名和HTTPS

---

## 📞 需要帮助？

如果遇到问题：
1. 查看控制台错误信息
2. 检查API服务器日志
3. 使用测试工具诊断
4. 查看故障排除部分

---

**祝你迁移顺利！** 🚀
