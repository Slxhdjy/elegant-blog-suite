# 🆘 服务器无法启动 - 终极解决方案

## 当前问题
服务器启动后立即停止，显示"Server has stopped"

## 🔍 诊断步骤

### 步骤1：测试简单服务器

运行最简单的测试服务器：
```
双击：test-simple-server.bat
```

**如果成功：**
- 窗口保持打开
- 显示"Simple test server running"
- 说明 Node.js 和基础环境正常

**如果失败：**
- 窗口立即关闭或显示错误
- 说明环境有问题，继续下一步

### 步骤2：检查 Node.js

打开命令行（cmd），运行：
```bash
node --version
```

**应该显示：** `v18.x.x` 或类似版本号

**如果显示错误：**
- Node.js 未安装或未添加到 PATH
- 下载安装：https://nodejs.org/

### 步骤3：检查依赖

在项目目录运行：
```bash
npm install
```

等待安装完成，应该看到：
```
added XXX packages
```

### 步骤4：检查端口占用

运行：
```bash
netstat -ano | findstr :3001
```

**如果有输出：**
- 端口被占用
- 找到进程ID（最后一列数字）
- 关闭该进程：`taskkill /PID 进程ID /F`

**如果没有输出：**
- 端口可用，继续下一步

## 🚀 解决方案

### 方案1：使用原有上传服务器（推荐）

原有的 `upload-server.js` 已经过测试，更稳定：

```
双击：🚀-快速启动服务器.bat
```

或手动运行：
```bash
node upload-server.js
```

**优点：**
- 已经过验证
- 稳定可靠
- 支持飞书图片上传

### 方案2：使用统一服务器

如果需要完整功能：

```
双击：start-unified-server.bat
```

**注意：**
- 启动后不要按回车键
- 不要在窗口中输入任何内容
- 只能按 Ctrl+C 停止

### 方案3：使用 PM2（高级用户）

安装 PM2：
```bash
npm install -g pm2
```

启动服务器：
```bash
pm2 start upload-server.js --name blog-server
```

查看状态：
```bash
pm2 status
```

查看日志：
```bash
pm2 logs blog-server
```

停止服务器：
```bash
pm2 stop blog-server
```

## 🎯 推荐配置

### 对于飞书导入功能

**最简单的方案：**

1. 使用原有的上传服务器
   ```
   双击：🚀-快速启动服务器.bat
   ```

2. 验证服务器运行
   ```
   浏览器打开：http://localhost:3001/upload/images
   ```
   应该看到 JSON 响应

3. 测试飞书导入
   - 打开后台编辑器
   - 点击"导入飞书文档"
   - 应该不再显示"服务器未启动"

## 📋 常见错误及解决

### 错误1：窗口一闪而过

**原因：** 服务器启动失败

**解决：**
```bash
# 在命令行中运行，查看错误
node upload-server.js
```

### 错误2：Cannot find module 'express'

**原因：** 依赖未安装

**解决：**
```bash
npm install
```

### 错误3：EADDRINUSE

**原因：** 端口被占用

**解决：**
```bash
# 查找占用端口的进程
netstat -ano | findstr :3001

# 关闭进程（替换 PID 为实际进程ID）
taskkill /PID 12345 /F
```

### 错误4：服务器启动后立即停止

**可能原因：**
1. 按了回车键
2. 在窗口中输入了内容
3. 代码有错误

**解决：**
1. 不要在服务器窗口按任何键
2. 使用 `test-simple-server.bat` 测试
3. 查看错误日志

## 🔧 调试技巧

### 1. 查看详细日志

创建文件 `start-with-log.bat`：
```batch
@echo off
node upload-server.js > server.log 2>&1
```

运行后查看 `server.log` 文件

### 2. 使用调试模式

```bash
node --inspect upload-server.js
```

然后在 Chrome 打开：`chrome://inspect`

### 3. 检查防火墙

确保防火墙允许 Node.js 访问网络

## 📝 测试清单

使用以下清单逐步排查：

- [ ] Node.js 已安装：`node --version`
- [ ] 依赖已安装：`npm install`
- [ ] 端口3001可用：`netstat -ano | findstr :3001`
- [ ] 简单服务器可运行：`test-simple-server.bat`
- [ ] 上传服务器可运行：`🚀-快速启动服务器.bat`
- [ ] 可以访问：`http://localhost:3001/upload/images`
- [ ] 飞书导入不显示错误

## 🎓 最佳实践

### 开发环境

**推荐使用：** 原有的 upload-server.js

**原因：**
- 简单稳定
- 专注于图片上传
- 已经过充分测试
- 满足飞书导入需求

### 生产环境

**推荐使用：** PM2 + 统一服务器

**原因：**
- 自动重启
- 日志管理
- 进程监控
- 开机自启

## 🆘 仍然无法解决？

### 最后的办法

1. **完全重新安装**
   ```bash
   # 删除 node_modules
   rmdir /s /q node_modules
   
   # 重新安装
   npm install
   ```

2. **使用不同的端口**
   - 编辑 `upload-server.js`
   - 修改 `const PORT = 3001;` 为 `const PORT = 3002;`
   - 同时修改前端配置

3. **检查系统环境**
   - 重启电脑
   - 检查杀毒软件是否阻止
   - 检查 Windows 防火墙设置

4. **使用备用方案**
   - 使用 Base64 模式（不需要服务器）
   - 手动下载飞书图片后上传

## 📞 获取帮助

如果以上方法都无效，请提供：

1. Node.js 版本：`node --version`
2. NPM 版本：`npm --version`
3. 操作系统版本
4. 错误截图或日志
5. 运行 `test-simple-server.bat` 的结果

---

**记住：**
- ✅ 使用 `🚀-快速启动服务器.bat` 最简单
- ✅ 不要在服务器窗口按回车键
- ✅ 使用 `test-simple-server.bat` 测试基础环境

**祝你成功！** 🎉
